<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jogo ‚Äì Interfaces Organizacionais</title>
  <style>
    :root{
      --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22c55e; --warn:#ef4444; --brand:#38bdf8;
    }
    *{box-sizing:border-box} html,body{height:100%} body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto; background:linear-gradient(180deg,#0b1222,#0f172a);} 
    .container{max-width:1000px; margin:0 auto; padding:24px}
    .card{background:linear-gradient(180deg,#0b0f1a,#0f172a); border:1px solid #1f2937; border-radius:18px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .row{display:grid; grid-template-columns:1fr; gap:16px}
    @media(min-width:900px){.row{grid-template-columns:2fr 1fr}}
    h1{color:var(--text); font-weight:800; letter-spacing:.3px; margin:0 0 10px}
    .subtitle{color:var(--muted); margin-bottom:18px}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:#111827; border:1px solid #1f2937; color:var(--muted); font-size:12px}
    .hud{display:flex; gap:10px; flex-wrap:wrap}
    .hud .item{background:#0b1220; border:1px solid #1f2937; border-radius:12px; padding:8px 12px; color:var(--muted); display:flex; align-items:center; gap:8px}
    .hud .value{color:var(--text); font-weight:700}
    .question{color:var(--text); font-size:20px; font-weight:700}
    .answers{display:grid; grid-template-columns:1fr; gap:10px}
    @media(min-width:700px){.answers{grid-template-columns:1fr 1fr}}
    button.choice{padding:14px; border-radius:14px; border:1px solid #1f2937; background:#0b1220; color:var(--text); text-align:left; cursor:pointer; transition:transform .04s ease, background .2s}
    button.choice:hover{transform:translateY(-1px); background:#0d1425}
    button.choice.correct{outline:2px solid var(--accent); background:rgba(34,197,94,.08)}
    button.choice.wrong{outline:2px solid var(--warn); background:rgba(239,68,68,.08)}
    .primary{background:linear-gradient(90deg,#06b6d4,#22c55e); color:#052e45; border:none; padding:12px 14px; border-radius:14px; font-weight:800; cursor:pointer}
    .ghost{background:#0b1220; color:var(--muted); border:1px solid #1f2937; padding:10px 12px; border-radius:12px; cursor:pointer}
    .footer{display:flex; justify-content:space-between; align-items:center; gap:10px}
    .explain{color:#cbd5e1; background:#0b1220; border:1px solid #1f2937; padding:12px; border-radius:12px; display:none}
    .progress{height:10px; border-radius:999px; background:#0b1220; border:1px solid #1f2937; overflow:hidden}
    .progress > div{height:100%; width:0; background:linear-gradient(90deg,#38bdf8,#22c55e)}
    .leader{color:var(--text)}
    table{width:100%; border-collapse:collapse}
    th,td{padding:8px; border-bottom:1px solid #1f2937; color:#cbd5e1; text-align:left}
    th{color:#94a3b8; font-weight:600}
    .tag{font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid #1f2937; color:#94a3b8}
    .hidden{display:none}
    dialog{border:none; border-radius:18px; padding:0; background:#0f172a; color:var(--text)}
    .modal{padding:24px; min-width:320px}
    input,textarea{width:100%; padding:10px 12px; border-radius:12px; border:1px solid #1f2937; background:#0b1220; color:var(--text)}
    a{color:#7dd3fc}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap">
        <div>
          <h1>Jogo ‚Äì Interfaces Organizacionais</h1>
          <div class="subtitle">Administra√ß√£o de Materiais ‚Ä¢ Aula gamificada (2h) ‚Ä¢ Pontos, tempo e ranking</div>
        </div>
        <div class="hud">
          <div class="item">‚è±Ô∏è Tempo: <span class="value" id="time">--</span></div>
          <div class="item">‚≠ê Pontos: <span class="value" id="score">0</span></div>
          <div class="item">üî• S√©rie: <span class="value" id="streak">0</span></div>
          <div class="item">‚ùì Quest√£o: <span class="value" id="qindex">0/0</span></div>
        </div>
      </div>

      <div class="progress" aria-label="progresso"><div id="bar"></div></div>

      <div class="row" style="margin-top:16px">
        <section class="card" style="background:transparent; border:none; box-shadow:none; padding:0">
          <div class="pill">Tema: Interfaces entre AM e demais setores</div>
          <div class="question" id="question">Clique em "Iniciar"</div>
          <div class="answers" id="answers"></div>
          <div class="explain" id="explain"></div>

          <div class="footer" style="margin-top:14px">
            <button class="ghost" id="skip">Pular</button>
            <div style="display:flex; gap:8px">
              <button class="ghost" id="configBtn">Configurar</button>
              <button class="primary" id="start">Iniciar</button>
            </div>
          </div>
        </section>

        <aside class="card" style="min-height:200px">
          <div style="display:flex; justify-content:space-between; align-items:center; gap:8px">
            <h3 style="margin:0">üèÜ Ranking (Top 10)</h3>
            <div>
              <button id="exportCsv" class="ghost">Exportar CSV</button>
              <button id="resetRank" class="ghost">Zerar</button>
            </div>
          </div>
          <div class="leader">
            <table id="table">
              <thead><tr><th>#</th><th>Jogador</th><th>Pontos</th><th>Acertos</th><th>Dura√ß√£o</th><th>Data</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="tag" style="margin-top:8px">Dica: use Live Server no VSCode para rodar localmente</div>
        </aside>
      </div>
    </div>
  </div>

  <dialog id="modal">
    <div class="modal">
      <h3 style="margin:0 0 8px">Configura√ß√µes da Partida</h3>
      <label>Seu nome
        <input id="playerName" placeholder="Ex.: Ana / Grupo 2" />
      </label>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:10px">
        <label>Qtd. de quest√µes
          <input id="qtd" type="number" value="10" min="5" max="20" />
        </label>
        <label>Tempo por quest√£o (s)
          <input id="secs" type="number" value="25" min="8" max="90" />
        </label>
      </div>

      <details style="margin-top:10px">
        <summary style="cursor:pointer">Banco de quest√µes (JSON) ‚Äì opcional</summary>
        <textarea id="customJson" rows="8" placeholder='[
  {"q":"A interface AM‚ÄìProdu√ß√£o visa principalmente...","choices":["...","...","...","..."],"a":1,"why":"..."}
]'></textarea>
      </details>

      <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:14px">
        <button class="ghost" id="closeCfg">Cancelar</button>
        <button class="primary" id="saveCfg">Salvar</button>
      </div>
    </div>
  </dialog>

  <script>
    // ---------- Utilidades ----------
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const shuffle = arr => arr.map(v => [Math.random(), v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);

    function fmtTime(ms){
      const s = Math.round(ms/1000);
      const m = Math.floor(s/60).toString().padStart(2,'0');
      const r = (s%60).toString().padStart(2,'0');
      return `${m}:${r}`;
    }

    // ---------- Banco de Quest√µes (conte√∫do alinhado ao material p.13‚Äì17) ----------
    const BASE_QUESTIONS = [
      { q:"Qual o objetivo principal da interface AM‚ÄìProdu√ß√£o?",
        choices:[
          "Controlar f√©rias da equipe",
          "Garantir materiais certos na hora certa",
          "Definir campanhas de marketing",
          "Registrar impostos"], a:1,
        why:"A Produ√ß√£o depende do suprimento adequado e no tempo correto para evitar paradas e retrabalho."},
      { q:"Quando a interface com Vendas √© falha, qual consequ√™ncia prov√°vel?",
        choices:["Excesso ou falta de estoque","Mais inova√ß√£o","Produ√ß√£o mais √°gil","Menos tributos"], a:0,
        why:"Sem previs√µes e dados de demanda, a AM erra o n√≠vel de estoque."},
      { q:"A interface organizacional caracteriza-se por...",
        choices:["Software espec√≠fico","Comunica√ß√£o e interdepend√™ncia entre setores","Relat√≥rio mensal","Exclusividade do RH"], a:1,
        why:"Interfaces s√£o pontos de contato que exigem fluxo de informa√ß√£o entre √°reas."},
      { q:"Financeiro interage com AM principalmente para...",
        choices:["Autorizar pagamentos e or√ßamentos","Definir embalagem","Selecionar layout de f√°brica","Treinar opera√ß√£o"], a:0,
        why:"Financeiro libera verbas, controla pagamentos e limites de compra."},
      { q:"Falhas na interface AM‚ÄìEngenharia resultam em...",
        choices:["Produtos fora de especifica√ß√£o","Mais clientes","Pre√ßos menores","Maior motiva√ß√£o"], a:0,
        why:"Especifica√ß√µes t√©cnicas incorretas geram n√£o conformidades."},
      { q:"Compras, dentro da interface com AM, √© respons√°vel por...",
        choices:["Recrutar pessoal","Negociar e adquirir materiais","Vender produtos","Auditar tributos"], a:1,
        why:"Compras executa o processo de aquisi√ß√£o com fornecedores."},
      { q:"RH apoia a AM principalmente em...",
        choices:["Treinamentos e dimensionamento de equipe","Pol√≠ticas de pre√ßo","Layout da loja","Programas de fidelidade"], a:0,
        why:"Capacita√ß√£o e aloca√ß√£o de pessoal impactam o desempenho da AM."},
      { q:"Uma boa interface AM‚ÄìLog√≠stica/Transporte garante...",
        choices:["Entrega dentro do lead time","Mais marketing","Menos impostos","Mais vendedores"], a:0,
        why:"Coordena√ß√£o de prazos e rotas assegura lead time confi√°vel."},
      { q:"Qual m√©trica ajuda a avaliar a interface com Vendas?",
        choices:["OTIF (on time in full)","NPS de colaboradores","ROI de m√≠dia","Horas de treinamento"], a:0,
        why:"OTIF mostra se a entrega atende prazo e quantidade prometidos."},
      { q:"Falhas na interface AM‚ÄìQualidade tendem a...",
        choices:["Aumentar refugos e devolu√ß√µes","Aumentar market share","Diminuir lead time","Aumentar satisfa√ß√£o"], a:0,
        why:"Sem alinhamento de crit√©rios de inspe√ß√£o, cresce a taxa de n√£o conformidade."},
    ];

    // ---------- Estado ----------
    let QUESTIONS = [...BASE_QUESTIONS];
    let current = 0, score = 0, streak = 0, timerId = null, perQuestionMs = 25000, startedAt = 0, name = "Convidado";
    let order = [];

    // ---------- UI ----------
    function setProgress(){
      const pct = (current/order.length)*100;
      $('#bar').style.width = pct + '%';
      $('#qindex').textContent = `${Math.min(current, order.length)}/${order.length}`;
    }

    function draw(){
      const i = order[current];
      const q = QUESTIONS[i];
      $('#question').textContent = q.q;
      const box = $('#answers'); box.innerHTML = '';
      q.choices.forEach((c,idx)=>{
        const b = document.createElement('button');
        b.className='choice';
        b.textContent = c;
        b.onclick = () => choose(idx);
        box.appendChild(b);
      });
      $('#explain').style.display = 'none';
      setProgress();
      startTimer();
    }

    function startGame(){
      $('#start').disabled = true;
      score=0; streak=0; current=0; QUESTIONS = QUESTIONS.slice();
      order = shuffle([...Array(QUESTIONS.length).keys()]).slice(0, parseInt($('#qtd').value || 10));
      perQuestionMs = Math.max(8000, Math.min(90000, parseInt($('#secs').value || 25)*1000));
      $('#score').textContent = score; $('#streak').textContent = streak; $('#explain').style.display='none';
      startedAt = performance.now();
      draw();
    }

    function startTimer(){
      let left = perQuestionMs; updateTimer(left);
      clearInterval(timerId);
      timerId = setInterval(()=>{
        left -= 100;
        if(left <= 0){ clearInterval(timerId); reveal(null, 0); }
        updateTimer(left);
      }, 100);
    }

    function updateTimer(ms){ $('#time').textContent = (ms/1000).toFixed(1)+'s'; }

    function choose(idx){
      clearInterval(timerId);
      const i = order[current];
      const q = QUESTIONS[i];
      const correct = q.a;
      const btns = $$('#answers .choice');
      btns.forEach((b,j)=>{
        if(j===correct) b.classList.add('correct');
        if(j===idx && j!==correct) b.classList.add('wrong');
        b.disabled = true;
      });
      const base = 100; // pontos base
      const timeLeft = parseFloat($('#time').textContent) || 0;
      const bonus = Math.round(timeLeft*5); // b√¥nus por tempo
      let gained = 0;
      if(idx===correct){ streak++; gained = base + bonus + (streak>1? (streak-1)*20 : 0); }
      else { streak = 0; }
      score += gained;
      $('#score').textContent = score; $('#streak').textContent = streak;
      reveal(correct, gained);
    }

    function reveal(correctIdx, gained){
      const i = order[current];
      const q = QUESTIONS[i];
      const exp = $('#explain');
      const msg = (correctIdx===null)? `Tempo esgotado. Resposta correta: ${q.choices[q.a]}.` :
                  (gained>0? `‚úÖ Correto! (+${gained} pts)` : `‚ùå Resposta incorreta. Correta: ${q.choices[q.a]}.`);
      exp.innerHTML = `<strong>${msg}</strong><br>${q.why}`;
      exp.style.display = 'block';
      setTimeout(next, 900);
    }

    function next(){
      current++;
      if(current >= order.length){ return finish(); }
      draw();
    }

    function finish(){
      clearInterval(timerId);
      const duration = performance.now()-startedAt;
      $('#question').textContent = `Fim de jogo, ${name}! Pontos: ${score} ‚Ä¢ Tempo: ${fmtTime(duration)} ‚Ä¢ Acertos: ${countHits()}/${order.length}`;
      $('#answers').innerHTML = '';
      $('#explain').style.display='none';
      saveScore({name, score, hits:countHits(), duration:fmtTime(duration), date:new Date().toLocaleString()});
      $('#start').disabled = false;
      setProgress();
      renderTable();
    }

    function countHits(){
      // Simplifica√ß√£o: como n√£o marcamos por quest√£o, estimamos pelos pontos base (>=100 um acerto)
      // Para precis√£o, poder√≠amos registrar por quest√£o; para esta vers√£o, armazenamos hits no finish.
      return Math.floor(score/100); // aproxima√ß√£o; ajustado ao salvar de forma expl√≠cita
    }

    // ---------- Ranking (localStorage) ----------
    const KEY = 'am_interfaces_ranking_v1';
    function getRank(){
      try{ return JSON.parse(localStorage.getItem(KEY))||[] }catch{ return [] }
    }
    function saveScore(entry){
      const data = getRank();
      data.push(entry);
      data.sort((a,b)=> b.score - a.score);
      const top = data.slice(0,10);
      localStorage.setItem(KEY, JSON.stringify(top));
    }
    function renderTable(){
      const tbody = $('#table tbody');
      const data = getRank();
      tbody.innerHTML = data.map((r,i)=>`<tr><td>${i+1}</td><td>${r.name}</td><td>${r.score}</td><td>${r.hits}</td><td>${r.duration}</td><td>${r.date}</td></tr>`).join('');
    }
    function exportCSV(){
      const rows = [['pos','jogador','pontos','acertos','duracao','data'], ...getRank().map((r,i)=>[i+1,r.name,r.score,r.hits,r.duration,r.date])];
      const csv = rows.map(r=>r.map(x=>`"${String(x).replaceAll('"','""')}"`).join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='ranking_interfaces.csv'; a.click(); URL.revokeObjectURL(url);
    }

    // ---------- Config modal ----------
    const modal = $('#modal');
    $('#configBtn').onclick = ()=>{ modal.showModal(); };
    $('#closeCfg').onclick = ()=> modal.close();
    $('#saveCfg').onclick = ()=>{
      name = $('#playerName').value?.trim() || 'Convidado';
      try{
        const txt = $('#customJson').value.trim();
        if(txt){
          const parsed = JSON.parse(txt);
          if(Array.isArray(parsed) && parsed.length>0){ QUESTIONS = parsed; }
        } else {
          QUESTIONS = [...BASE_QUESTIONS];
        }
      }catch(e){ alert('JSON inv√°lido. Mantendo quest√µes padr√£o.'); QUESTIONS = [...BASE_QUESTIONS]; }
      modal.close();
    };

    // ---------- Controles ----------
    $('#start').onclick = ()=> startGame();
    $('#skip').onclick = ()=> { clearInterval(timerId); reveal(null,0); };
    $('#exportCsv').onclick = exportCSV;
    $('#resetRank').onclick = ()=>{ if(confirm('Tem certeza que deseja zerar o ranking?')){ localStorage.removeItem(KEY); renderTable(); } };

    // ---------- Boot ----------
    renderTable();
    // Abre modal de nome na primeira vez
    if(!localStorage.getItem('am_first')){ localStorage.setItem('am_first','1'); $('#configBtn').click(); }
  </script>
</body>
</html>
